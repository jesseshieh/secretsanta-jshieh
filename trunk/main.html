<html>
  <head>
    <title>{{ title }}</title>
    <link rel='stylesheet' type='text/css'
          href='http://yui.yahooapis.com/2.6.0/build/base/base-min.css'>
    <link rel='stylesheet' type='text/css'
          href='http://yui.yahooapis.com/2.6.0/build/fonts/fonts-min.css'>
    <link rel='stylesheet' type='text/css'
          href='stylesheets/main.css'>
    <script src="/javascript/livevalidation_standalone.js"></script>
    <script>
      var is_mass_validating = false;
      var default_num_invitees = 4;
      var num_invitees = 0;

      var on_invalid = function() {
        this.insertMessage(this.createMessageSpan());
        this.addFieldClass();
        disable_submit();
      };

      var on_valid = function() {
        this.insertMessage(this.createMessageSpan());
        this.addFieldClass();

        if (!is_mass_validating) {
          is_mass_validating = true;
          this.formObj.removeField(this);
          if (LiveValidation.massValidate(this.formObj.fields)) {
            enable_submit();
          }
          this.formObj.addField(this);
          is_mass_validating = false;
        }
      };

      function disable_submit() {
        document.getElementById("submit").disabled = true;
      }

      function enable_submit() {
        document.getElementById("submit").disabled = false;
      }

      function add_more_invitees() {
        add_one_more_invitee();
        add_one_more_invitee();
        add_one_more_invitee();
        add_one_more_invitee();
      }

      function add_one_more_invitee() {
        invitee_email_list = document.getElementById('invitees');
        id = "invitee" + num_invitees;
        new_element = document.createElement('li');
        new_element.innerHTML = "<input class='textfield' id='"
                                + id
                                + "' name='"
                                + id
                                + "'>";
        invitee_email_list.appendChild(new_element);

        // add validation indicator
        var email_validator = new LiveValidation("invitee" + num_invitees, {
          validMessage: "\u2714",
          onInvalid: on_invalid,
          onValid: on_valid
        });
        email_validator.add(Validate.Email, { failureMessage: "\u2716" });

        // require at least 2 invitees otherwise secret santa doesn't make sense
        if (num_invitees < 2) {
          email_validator.add(Validate.Presence, { failureMessage: "\u2716" });
        }

        num_invitees++;
      }

      function add_default_invitees() {
        for (var i = 0; i < default_num_invitees; i ++) {
          add_one_more_invitee();
        }
      }
    </script>
  </head>
  <body>
    <h1>Secret Santa</h1>
    <h2>The easiest, fastest way to set up a secret santa gift exchange.</h2>

    <div class="box">

      <form action='/confirm' method='post'>
        <div class="section">
          <div class="label">
            <div class="title">Step 1. What's your email address?</div>
            <div class="description">So we can send you a code to manage stuff. You'll be included in the game too.</div>
          </div>
          <input class="textfield" id="creator" name="creator">
          <script>
            var creator = new LiveValidation("creator", {
              validMessage: "\u2714",
              onInvalid: on_invalid,
              onValid: on_valid
            });
            creator.add(Validate.Presence, { failureMessage: "\u2716" });
            creator.add(Validate.Email, { failureMessage: "\u2716" });
          </script>
        </div>

        <div class="section">
          <div class="label">
            <div class="title">Step 2. Who is participating?</div>
            <div class="description">Enter email addresse.  We assume that you've already finalized this list with everyone already.  You can't change this later.</div>
          </div>
          <ol id="invitees">
            <script>add_default_invitees()</script>
          </ol>
          <a class="small" href="javascript:add_more_invitees()">
            + Add more people
          </a>
        </div>

        <div class="section" style="text-align:right">
          <input type="submit" class="submit" id="submit" value="Create &raquo;">
          <script>
            disable_submit();
            LiveValidation.massValidate(creator.formObj.fields);
          </script>
        </div>
      </form>

    </div>
  </body>
</html>
