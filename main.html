<html>
  <head>
    <title>{{ title }}</title>
    <link rel='stylesheet' type='text/css'
          href='http://yui.yahooapis.com/2.6.0/build/base/base-min.css'>
    <link rel='stylesheet' type='text/css'
          href='http://yui.yahooapis.com/2.6.0/build/fonts/fonts-min.css'>
    <link rel='stylesheet' type='text/css'
          href='stylesheets/main.css'>
    <script src="/javascript/livevalidation_standalone.js"></script>
    <script>
      var default_num_invitees = 4;
      var num_invitees = 0;

      function disable_submit() {
        document.getElementById("submit").disabled = true;
      }

      function enable_submit() {
        document.getElementById("submit").disabled = false;
      }

      function add_one_more_invitee() {
        invitee_email_list = document.getElementById('invitees');
        id = "invitee" + num_invitees;
        new_element = document.createElement('li');
        new_element.innerHTML = "<input class='textfield' id='"
                                + id
                                + "' name='"
                                + id
                                + "'>";
        invitee_email_list.appendChild(new_element);

        // add validation indicator
        var email_validator = new LiveValidation("invitee" + num_invitees, {
          validMessage: "\u2714",
          onInvalid: function() {
            this.insertMessage(this.createMessageSpan());
            this.addFieldClass();
            disable_submit();
          },
          onValid: function() {
            this.insertMessage(this.createMessageSpan());
            this.addFieldClass();

            this.formObj.removeField(this);
            if (LiveValidation.massValidate(this.formObj.fields)) {
              enable_submit();
            }
            this.formObj.addField(this);
          }
        });
        if (num_invitees < 2) {
          // require at least 2 invitees otherwise secret santa doesn't make sense
          email_validator.add(Validate.Presence, { failureMessage: "\u2716" });
        }
        email_validator.add(Validate.Email, { failureMessage: "\u2716" });

        num_invitees++;
      }

      function add_default_invitees() {
        for (var i = 0; i < default_num_invitees; i ++) {
          add_one_more_invitee();
        }
      }
    </script>
  </head>
  <body>
    <h1>Secret Santa</h1>
    <h2>The easiest, fastest way to set up a secret santa gift exchange.</h2>

    <div class="box">

      <form action='/confirm' method='post'>
        <div class="section">
          <div class="label">
            <div class="title">What's your email address?</div>
            <div class="description">So we can send you a password to manage stuff</div>
          </div>
          <input class="textfield" id="creator" name="creator">
          <script>
            var creator = new LiveValidation("creator", { validMessage: "\u2714" });
            creator.add(Validate.Email, { failureMessage: "\u2716" });
          </script>
        </div>

        <div class="section">
          <div class="label">
            <div class="title">And the email addresses of everyone you want to invite?</div>
            <div class="description">NOTE: We assume that you've already finalized this list with everyone beforehand</div>
          </div>
          <ol id="invitees">
            <script>add_default_invitees()</script>
          </ol>
          <a class="small" href="javascript:add_one_more_invitee()">
            + Add more people
          </a>
        </div>

        <div class="section" style="text-align:right">
          <input type="button" class="submit" id="submit" value="Next step &raquo;">
          <script>
            disable_submit();
            LiveValidation.massValidate(creator.formObj.fields);
          </script>
        </div>
      </form>

    </div>
  </body>
</html>
