<html>
  <head>
    <META http-equiv="Content-Type" CONTENT="text/html; charset=iso-8859-1">
    <META NAME="Description" CONTENT="Secret Santa Organizer: Set up a secret santa gift exchange. Easy, Fast, and Free.">
    <META name="Keywords" content="online secret santa generator gift exchange organizer organize organise organiser set up setup create game">

    <title>{{ title }}</title>
    <link type="text/css"
          href="stylesheets/main.css"
          rel="stylesheet" />
    <link type="text/css"
          href="stylesheets/{{ theme }}/jquery-ui-1.7.2.custom.css"
          rel="stylesheet" />
    <script type="text/javascript"
            src="/javascript/jquery-1.3.2.min.js"></script>
    <script type="text/javascript"
            src="/javascript/jquery-ui-1.7.2.custom.min.js"></script>
    <script src="/javascript/livevalidation_standalone.js"></script>
    <script>

      var is_mass_validating = false;
      var default_num_invitees = 4;
      var num_invitees = 1; // start at 1.  creator is 0.
      var third_email_validator;

      var on_invalid = function() {
        this.insertMessage(this.createMessageSpan());
        this.addFieldClass();
        disable_submit();
      };

      var on_valid = function() {
        this.insertMessage(this.createMessageSpan());
        this.addFieldClass();

        if (!is_mass_validating) {
          is_mass_validating = true;
          this.formObj.removeField(this);
          if (LiveValidation.massValidate(this.formObj.fields)) {
            enable_submit();
          }
          this.formObj.addField(this);
          is_mass_validating = false;
        }
      };

      function disable_submit() {
        document.getElementById("submit").disabled = true;
      }

      function enable_submit() {
        document.getElementById("submit").disabled = false;
      }

      function add_more_invitees() {
        add_one_more_invitee();
        add_one_more_invitee();
        add_one_more_invitee();
        add_one_more_invitee();
      }

      function add_one_more_invitee() {
        invitee_email_list = document.getElementById('invitees');
        id = "invitee" + num_invitees;
        new_element = document.createElement('li');
        new_element.innerHTML = "<label>Email</label>"
                                + "<input class='textfield' id='"
                                + id + "_email"
                                + "' name='"
                                + id + "_email"
                                + "'><br>"
                                + "<label>Name</label>"
                                + "<input class='textfield' id='"
                                + id + "_name"
                                + "' name='"
                                + id + "_name"
                                + "'>";

        invitee_email_list.appendChild(new_element);

        // add validation indicator
        var email_validator = new LiveValidation(
          "invitee" + num_invitees + "_email", {
          validMessage: "\u2714",
          onInvalid: on_invalid,
          onValid: on_valid
        });
        email_validator.add(Validate.Email, { failureMessage: "\u2716" });

        // require at least 2 invitees otherwise secret santa doesn't make
        // sense
        if (num_invitees < 4) {
          if (num_invitees < 3) {
            email_validator.add(Validate.Presence, {
                                failureMessage: "\u2716" });
          } else {
            // this is invitee #3.  whether this is required or not depends
            // on if the organizer is participating
            //
            // this is recessary in case of a refresh where 'just organizing'
            // is the default
            radios = document.getElementsByName("is_creator_participating");
            for (var i = 0; i < radios.length; i++) {
              if (radios[i].checked == true) {
                if (radios[i].value == "False") {
                  email_validator.add(Validate.Presence, {
                                      failureMessage: "\u2716" });
                }
              }
            }
            third_email_validator = email_validator;
          }
        }

        num_invitees++;
      }

      function add_default_invitees() {
        for (var i = 0; i < default_num_invitees; i ++) {
          add_one_more_invitee();
        }
      }

      function add_third_email_validator() {
        third_email_validator.destroy();

        // add validation indicator
        var email_validator = new LiveValidation(
          "invitee3_email", {
          validMessage: "\u2714",
          onInvalid: on_invalid,
          onValid: on_valid
        });
        email_validator.add(Validate.Email, { failureMessage: "\u2716" });
        email_validator.add(Validate.Presence, {
                                  failureMessage: "\u2716" });
        email_validator.validate();
        third_email_validator = email_validator;
      }

      function remove_third_email_validator() {
        third_email_validator.destroy();

        // add validation indicator
        var email_validator = new LiveValidation(
          "invitee3_email", {
          validMessage: "\u2714",
          onInvalid: on_invalid,
          onValid: on_valid
        });
        email_validator.add(Validate.Email, { failureMessage: "\u2716" });
        email_validator.validate();
        third_email_validator = email_validator;
      }
    </script>
  </head>
  <body>
    <h1>Secret Santa</h1>
    <h2>The easiest, fastest way to set up a secret santa gift exchange.</h2>

    <form action='/confirm' method='post'>

    <div class="box">
        <div class="section">
          <div class="label">
            <div class="title">Step 1. Who is organizing?</div>
            <div class="description">So we can send you a code to manage stuff.</div>
          </div>
          <div>
            <label>Email</label>
            <input class="textfield" id="creator_email"
                   name="creator_email">
            <span class="small">
              <input type="radio" name="is_creator_participating"
                     value="True" onclick="remove_third_email_validator()"
                     checked>
              Participating?
              <input type="radio" name="is_creator_participating"
                     value="False" onclick="add_third_email_validator()">
              Just organizing?
            </span>
            <label>Name</label>
            <input class="textfield" id="creator_name"
                   name="creator_name">
          </div>
          <div class="small" style="margin-top:3px">
            We'll never share your or your friends' info with
            anyone.
          </div>
          <script>
            var creator = new LiveValidation("creator_email", {
              validMessage: "\u2714",
              onInvalid: on_invalid,
              onValid: on_valid
            });
            creator.add(Validate.Presence, { failureMessage: "\u2716" });
            creator.add(Validate.Email, { failureMessage: "\u2716" });
          </script>
        </div>
    </div>

    <div class="box">
        <div class="section">
          <div class="label">
            <div class="title">Step 2. Who is participating?</div>
            <div class="description">We assume that you've already finalized this list with everyone already.  You can't change this later.</div>
          </div>
          <ol id="invitees">
            <script>add_default_invitees()</script>
          </ol>
          <input type="button" style="margin-top:10px;font-size:77%"
                 onclick="add_more_invitees();return false;"
                 value="+ Add more people"/>
        </div>
    </div>

    <div class="next_box">
        <div class="section" style="text-align:right">
          <button type="submit" class="submit" id="submit">
            Create &raquo;
          </button>
        </div>
    </div>
    </form>
    <script>
      $(document).ready(function () {
        $(":button").addClass("fg-button ui-state-default ui-corner-all");
        $(":button").hover(
          function(){
            $(this).addClass("ui-state-hover");
          },
          function(){
            $(this).removeClass("ui-state-hover");
          }
        );
        $(".box").tabs();
        disable_submit();
        LiveValidation.massValidate(creator.formObj.fields);
      });
    </script>
    <script type="text/javascript">
      var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
      document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
      try {
      var pageTracker = _gat._getTracker("UA-11702048-1");
      pageTracker._trackPageview();
      } catch(err) {}
    </script>
  </body>
</html>
